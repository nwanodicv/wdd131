!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AnalyticsWrapper=t()}(this,function(){"use strict";for(var n,s=256,a=[];s--;)a[s]=(s+256).toString(16).substring(1);function d(){var e,t=0,r="";if(!n||256<s+16){for(n=Array(t=256);t--;)n[t]=256*Math.random()|0;t=s=0}for(;t<16;t++)e=n[s+t],r+=6==t?a[15&e|64]:8==t?a[63&e|128]:a[e],1&t&&1<t&&t<11&&(r+="-");return s++,r}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r){if("object"!==i(e)||"object"!==i(t))return t;if(Array.isArray(e)&&Array.isArray(t))for(r=0;r<t.length;r++)e[r]=o(e[r],t[r]);else for(r in t)e[r]=o(e[r],t[r]);return e}function c(e){var t,r,n;if(Array.isArray(e))for(r=Array(t=e.length);t--;)r[t]=(n=e[t])&&"object"===i(n)?c(n):n;else{if("[object Object]"!==Object.prototype.toString.call(e))return e;for(t in r={},e)"__proto__"===t?Object.defineProperty(r,t,{value:c(e[t]),configurable:!0,enumerable:!0,writable:!0}):r[t]=(n=e[t])&&"object"===i(n)?c(n):n}return r}class x{constructor(){this._data={}}update(...t){for(let e=0;e<t.length;e+=1)o(this._data,c(t[e]));return this.toJSON()}overlay(...t){var r={eventAction:null,eventLabel:null,eventCategory:null};o(r,this.toJSON());for(let e=0;e<t.length;e+=1)o(r,c(t[e]));return r}toJSON(){return c(this._data)}}var t=(e,t)=>{const r=Object.assign(Object.assign({},t),{eventCategory:"userInteraction",eventAction:e,uiEventName:""});return r.uiEventName=[r.eventAction,r.pageSection,r.eventLabel].filter(e=>e).join("."),r};let r=null,l=!1;function u(e,t,r){if((l||r)&&window&&window.console){var n="Analytics Wrapper -> "+t;switch(e){case 1:console.info(n);break;case 2:console.warn(n);break;case 3:console.error(n);break;default:console.debug(n)}}}class h{constructor(e){l=e}debug(e){u(0,e)}info(e){u(1,e)}warn(e){u(2,e)}error(e,t){u(3,e,t)}static getLogger(e){return null!=e&&(l=e),r=r||new h(e)}}const g=(new class{constructor(){this._logger=h.getLogger(),this.getGlobal=()=>"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:(this._logger.error("Couldn't define polyfill version for globalThis. Returning null."),null)}}).getGlobal();var U=Object.freeze({__proto__:null,AccountSwitched:class{async accountSwitched(e){return this.track("Account Switched",e)}},AccountVerified:class{async accountVerified(e){return this.track("Account Verified",e)}},AssetViewed:class{async assetViewed(e){return this.track("Asset Viewed",e)}},AudienceSelected:class{async audienceSelected(e){return this.track("Audience Selected",e)}},RequestStatus:class{async requestStatus(e){return this.track("Request Status",e)}},CalendarSubscribed:class{async calendarSubscribed(e){return this.track("Calendar Subscribed",e)}},CalendarToggledOff:class{async calendarToggledOff(e){return this.track("Calendar Toggled Off",e)}},CalendarToggledOn:class{async calendarToggledOn(e){return this.track("Calendar Toggled On",e)}},CalendarTopicScheduled:class{async calendarTopicScheduled(e){return this.track("Calendar Topic Scheduled",e)}},CalendarUnsubscribed:class{async calendarUnsubscribed(e){return this.track("Calendar Unsubscribed",e)}},CartViewed:class{async cartViewed(e){return this.track("Cart Viewed",e)}},Change:class{async change(e){e=t("change",e);return this.track("change",e)}},CheckoutStarted:class{async checkoutStarted(e){return this.track("Checkout Started",e)}},CheckoutError:class{async checkoutError(e){return this.track("Checkout Error",e)}},Click:class{async click(e){e=t("click",e);return this.track("click",e)}},ComponentViewed:class{async componentViewed(e){return this.track("Component Viewed",e)}},CustomEvent:class{async customEvent(e,t){try{var r=this._analyticsData.overlay(t);return await this.sendEvent("Track",{name:e,data:r})}catch(e){t="Unable to send custom event";throw this._logger.error(t+": "+e),new Error(t)}}},designDownloaded:class{async designDownloaded(e){return this.track("Design Downloaded",e)}},DesignRendered:class{async designRendered(e){return this.track("Design Rendered",e)}},DesignShared:class{async designShared(e){return this.track("Design Shared",e)}},Error:class{async error(t){try{var e=this._analyticsData.overlay({error:(e=>{var{message:t,name:r,stack:n}=e;return Object.assign({message:t,name:r,stack:n},e)})(t)});return await this.sendEvent("Error",{name:"Error",data:e})}catch(e){t="Unable to send Error event";throw this._logger.error(t+": "+e),new Error(t)}}},ExperimentViewed:class{async experimentViewed(e){return this.track("Experiment Viewed",e)}async experiment(e){return this.track("Experiment Viewed",e)}},Hover:class{async hover(e){e=t("hover",e);return this.track("hover",e)}},ImageUploaded:class{async imageUploaded(e){return this.track("Image Uploaded",e)}},IndustrySelected:class{async industrySelected(e){return this.track("Industry Selected",e)}},InsightClosed:class{async insightClosed(e){return this.track("Insight Closed",e)}},InsightOpened:class{async insightOpened(e){return this.track("Insight Opened",e)}},InviteSent:class{async inviteSent(e){return this.track("Invite Sent",e)}},ObjectiveSelected:class{async objectiveSelected(e){return this.track("Objective Selected",e)}},OrderCompleted:class{async orderCompleted(e){return this.track("Order Completed",e)}},Page:class{async page(t){try{var e=this._analyticsData.update({page:t}),r=(()=>{var{href:e,pathname:t,search:r}=g.location,{referrer:n,title:s}=g.document;return{path:t,referrer:n,search:r,title:s,url:e}})();return o(r,e),await this.sendEvent("Page",{data:r})}catch(e){t="Unable to send page event";throw this._logger.error(t+": "+e),new Error(t)}}},PaymentInfoEntered:class{async paymentInfoEntered(e){return this.track("Payment Info Entered",e)}},ProductAdded:class{async productAdded(e){return Array.isArray(e.products)?this.sendProductArray("Product Added",e):this.track("Product Added",e)}},ProductAddedToWishlist:class{async productAddedToWishlist(e){return Array.isArray(e.products)?this.sendProductArray("Product Added to Wishlist",e):this.track("Product Added to Wishlist",e)}},ProductClicked:class{async productClicked(e){return this.track("Product Clicked",e)}},ProductDownloaded:class{async productDownloaded(e){return Array.isArray(e.products)?this.sendProductArray("Product Downloaded",e):this.track("Product Downloaded",e)}},ProductLicensed:class{async productLicensed(e){return this.track("Product Licensed",e)}},ProductListFiltered:class{async productListFiltered(e){return this.track("Product List Filtered",e)}},ProductListViewed:class{async productListViewed(e){return this.track("Product List Viewed",e)}},ProductRemoved:class{async productRemoved(e){return Array.isArray(e.products)?this.sendProductArray("Product Removed",e):this.track("Product Removed",e)}},ProductRemovedFromWishlist:class{async productRemovedFromWishlist(e){return Array.isArray(e.products)?this.sendProductArray("Product Removed from Wishlist",e):this.track("Product Removed from Wishlist",e)}},ProductShared:class{async productShared(e){return this.track("Product Shared",e)}},ProductUploaded:class{async productUploaded(e){return Array.isArray(e.products)?this.sendProductArray("Product Uploaded",e):this.track("Product Uploaded",e)}},ProductViewed:class{async productViewed(e){return this.track("Product Viewed",e)}},ProductsSearched:class{async productsSearched(e){return this.track("Products Searched",e)}async productSearched(e){return this.track("Products Searched",e)}},ProjectCreated:class{async projectCreated(e){return this.track("Project Created",e)}},ProjectDeleted:class{async projectDeleted(e){return this.track("Project Deleted",e)}},ProjectShared:class{async projectShared(e){return this.track("Project Shared",e)}},PromotionClicked:class{async promotionClicked(e){return this.track("Promotion Clicked",e)}},PromotionViewed:class{async promotionViewed(e){return this.track("Promotion Viewed",e)}},SignedIn:class{async signedIn(t){try{var e=this._analyticsData.overlay(t),r=e.user["id"];return r&&this.identify(r,e.user),await this.sendEvent("Signed In",{data:e})}catch(e){t="Unable to send Signed In event";throw this._logger.error(t+": "+e),new Error(t)}}},SignedOut:class{async signedOut(t){try{var e=this._analyticsData.overlay(t);return await this.sendEvent("Signed Out",{data:e})}catch(e){t="Unable to send Signed Out event";throw this._logger.error(t+": "+e),new Error(t)}}},SignedUp:class{async signedUp(t){try{var e=this._analyticsData.overlay(t),r=e.user["id"];return r&&this.identify(r,e.user),await this.sendEvent("Signed Up",{data:e})}catch(e){t="Unable to send Signed Up event";throw this._logger.error(t+": "+e),new Error(t)}}},Submit:class{async submit(e){e=t("submit",e);return this.track("submit",e)}},TemplateLoaded:class{async templateLoaded(e){return this.track("Template Loaded",e)}},TooltipViewed:class{async tooltipViewed(e){return this.track("Tooltip Viewed",e)}},OptimizeActivate:class{async optimizeActivate(e){return this.track("optimize.activate",e)}},UserInteracted:class{async userInteracted(e){return this.track("User Interacted",e)}},TrackAction:class{async trackAction(e,t){t=Object.assign(Object.assign({},t),{action:e});return this._logger.debug("Tracking action: "+JSON.stringify(t)),this.track("action",t)}},SurveyViewed:class{async surveyViewed(e){return this.track("Survey Viewed",e)}},EditingSessionSummary:class{async editingSessionSummary(e){return this.track("Editing Session Summary",e)}},InvoiceSubmitted:class{async invoiceSubmitted(e){return this.track("Invoice Submitted",e)}},InvoiceError:class{async invoiceError(e){return this.track("Invoice Error",e)}}}),e=(t,e)=>Object.assign({},...e.map(e=>({[e]:t[e]})));var p={click:"click",submit:"submit",change:"change",hover:"mouseenter"},y=(Object.entries||(Object.entries=e=>{var t=Object.keys(e);let r=t.length;const n=new Array(r);for(;r;)--r,n[r]=[t[r],e[t[r]]];return n}),(e,n)=>r=>Object.entries(e).map(([e,t])=>({action:e,domEvent:t,handler:r(e),delegate:n})));const M=y(e(p,["hover"]),!1),R=y(e(p,["change","click","submit"]),!0);const m="[data-track]";function v(e){if(e.dataset&&void 0!==e.dataset.track){const[t,r,n,...s]=e.dataset.track.trim().split(".");delete e.dataset.track,e.dataset.trackAction=t.replace(/\s*,\s*/," ").trim(),void 0!==r&&(e.dataset.trackSection=r.trim()),void 0!==n&&(e.dataset.trackLabel=n.trim()),s.length&&(e.dataset.trackValue=s.join(".").trim())}}function G(e){[e].concat(...e.querySelectorAll(m)).forEach(v),e=e,new g.MutationObserver(e=>e.reduce((e,t)=>e.concat(Array.from(t.addedNodes)),[]).filter(e=>e.nodeType===g.Node.ELEMENT_NODE).reduce((e,t)=>e.concat(t.matches(m)?t:[],Array.from(t.querySelectorAll(m))),[]).forEach(v)).observe(e,{childList:!0,subtree:!0})}var f,w=C,_=0,b=0,k={},E={};function S(e,t,r){return"_root"==t?r:e!==r?function(e){if(!f){if(e.matches)return f=e.matches;if(e.webkitMatchesSelector)return f=e.webkitMatchesSelector;if(e.mozMatchesSelector)return f=e.mozMatchesSelector;if(e.msMatchesSelector)return f=e.msMatchesSelector;if(e.oMatchesSelector)return f=e.oMatchesSelector;f=C.matchesSelector}return f}(e).call(e,t)?e:e.parentNode?(_++,S(e.parentNode,t,r)):void 0:void 0}function O(e,t,r,n){if(this.element){e instanceof Array||(e=[e]),r||"function"!=typeof t||(r=t,t="_root");for(var s,a,i,o,u=this.id,c=0;c<e.length;c++)if(n){v=v=y=m=p=f=g=h=l=d=void 0;var d=this,l=e[c],h=t,g=r;if(k[d.id])if(l)if(g||h)if(g){if(k[d.id][l]&&k[d.id][l][h]){for(var p=0;p<k[d.id][l][h].length;p++)if(k[d.id][l][h][p]===g){k[d.id][l][h].splice(p,1),k[d.id][l][h].match=void 0;break}var y,m=!1;for(y in k[d.id])for(var v in k[d.id][y]){v=k[d.id][y][v];if(Array.isArray(v)&&0<v.length){m=!0;break}}m||delete E[d.id]}}else delete k[d.id][l][h];else k[d.id][l]={};else for(var f in k[d.id])k[d.id].hasOwnProperty(f)&&(k[d.id][f]={})}else k[u]&&k[u][e[c]]||C.addEvent(this,e[c],w(e[c])),s=this,a=e[c],i=t,o=r,k[s.id]||(k[s.id]={}),k[s.id][a]||(k[s.id][a]={}),k[s.id][a][i]||(k[s.id][a][i]=[]),k[s.id][a][i].push(o);return this}function w(l){return function(e){var t=u,r=e,n=l;if(k[t][n]){var s,a,i=r.target||r.srcElement,o={},c=0,d=0;for(s in _=0,k[t][n])k[t][n].hasOwnProperty(s)&&(a=S(i,s,E[t].element))&&C.matchesEvent(n,E[t].element,a,"_root"==s,r)&&(_++,k[t][n][s].match=a,o[_]=k[t][n][s]);for(r.stopPropagation=function(){r.cancelBubble=!0},c=0;c<=_;c++)if(o[c])for(d=0;d<o[c].length;d++){if(!1===o[c][d].call(o[c].match,r))return void C.cancel(r);if(r.cancelBubble)return}}}}}function C(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!(this instanceof C)){for(var r in E)if(E[r].element===e)return E[r];return E[++b]=new C(e,b),E[b]}this.element=e,this.id=t}C.prototype.on=function(e,t,r){return O.call(this,e,t,r)},C.prototype.off=function(e,t,r){return O.call(this,e,t,r,!0)},C.matchesSelector=function(){},C.cancel=function(e){e.preventDefault(),e.stopPropagation()},C.addEvent=function(e,t,r){e.element.addEventListener(t,r,"blur"==t||"focus"==t)},C.matchesEvent=function(){return!0};const K=(t,r)=>e=>w(e).off(t,r).on(t,r),H=r=>(e,t)=>e.concat(t.matches(r)?t:[],Array.from(t.querySelectorAll(r))),I=e=>`[data-track-action~=${e}]`,B=n=>({action:e,domEvent:t,handler:r})=>w(n).off(t,I(e),r).on(t,I(e),r),q=(e,t,r)=>{t.delegate||r.filter(e=>e.nodeType===g.Node.ELEMENT_NODE).reduce(H(I(t.action)),[]).forEach(K(t.domEvent,t.handler))},W=(e,t,r)=>{const n=r.filter(e=>e.nodeType===g.Node.ELEMENT_NODE).reduce(H(I(t.action)),[]);var s,a;t.delegate&&0<n.length?B(e)(t):t.delegate||n.forEach((s=t.domEvent,a=t.handler,e=>w(e).off(s,a)))},F=(e,t)=>e.forEach((n=>({action:e,domEvent:t,handler:r})=>n.querySelectorAll(I(e)).forEach(K(t,r)))(t)),z=(e,t)=>e.forEach((r=>t=>new g.MutationObserver(e=>{e.forEach(e=>{W(r,t,Array.from(e.removedNodes)),q(r,t,Array.from(e.addedNodes))})}).observe(r,{childList:!0,subtree:!0}))(t)),J=(void 0!==g&&g.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,r){r=r||void 0!==g&&g;for(let e=0;e<this.length;e+=1)t.call(r,this[e],e,this)}),{checkbox:e=>Array.from(document.getElementsByName(e.name)).filter(e=>e.checked).map(e=>e.value),"select-multiple":e=>Array.from(e.selectedOptions).map(e=>e.value),default:e=>e.value});const Q={change:r=>(e,t)=>{Object.assign(t.eventValue,{formElementValue:(e=e,(J[e.type]||J.default)(e))}),r(t)},hover:i=>(n,s)=>{const a=(new Date).getTime();n.addEventListener("mouseleave",function e(){var t=(new Date).getTime()-a,{eventValue:{hoverTimeThreshold:r=1500}}=s;r<t&&(Object.assign(s.eventValue,{hoverTime:t}),i(s)),n.removeEventListener("mouseleave",e)})},default:r=>(e,t)=>r(t)};var $=(s,a)=>n=>function(e){var t,r;t=n,r=s,(Q[t]||Q.default)(r[t].bind(r))(e.target,Object.assign(Object.assign({},a(this,e)),{eventAction:n,pageSection:this.dataset.trackSection,eventLabel:this.dataset.trackLabel,name:(t=e.target).name||t.textContent,eventValue:(e=>{try{return JSON.parse(e.dataset.trackValue||"{}")}catch(e){return{}}})(this)}))};const Y={scope:g.document,initialData:()=>({})};class Z{constructor(e={}){this.options=e,this.options=(e=[e,Y],Object.assign({},...e.reverse()))}listen(s){return new Promise(e=>{r=$(s,this.options.initialData);var t,{direct:r,delegated:n}={direct:M(r),delegated:R(r)};G(this.options.scope),t=this.options.scope,n.forEach(B(t)),F(r,this.options.scope),z([...n,...r],this.options.scope),e()})}getOptions(){return this.options}}class X{constructor(){this._stack={}}use(e,...t){e=e||"all";this._stack[e]?this._stack[e].push(...t):this._stack[e]=t}async execute(e,n){const s=[...this._stack.all||[]],a=(Object.prototype.hasOwnProperty.call(this._stack,e)&&s.push(...this._stack[e]),async(e,t)=>{if(e===s.length)return t;const r=s[e];await r(n,()=>a(e+1,t))});e=await a(0,n);if(e)return e}}const A={uuid:null,href:null};var ee=(e,t)=>{var r=null==(r=g.location)?void 0:r.href;r!==A.href&&(A.href=r,A.uuid=d()),e.payload.data.page_view_id=A.uuid,t()},te=(e,t)=>{e.payload.data.aw_providers=e.wrapper.getProvidersNames(),t()},re=(e,t)=>{var r=e.payload.data.event_id||d();e.payload.data.event_id=r,t()},ne=(e,t)=>{var r=e.payload.data["sstk_session_id"],n=e.wrapper.trackingIds.extendSession();n!==r&&(e.wrapper.setData({sstk_session_id:n}),e.payload.data.sstk_session_id=n),t()},se=(e,t)=>{var r=e.wrapper.getAnonId(),n=e.wrapper.trackingIds.googleClientId;e.payload.options=Object.assign(Object.assign({},e.payload.options),{anonymousId:r,googleClientId:n}),t()},ae=(e,t)=>{var r=e.payload.data["visit"],{basket:n,carton:s,egg:a}=e.wrapper.trackingIds.persistBasketCartEgg(r);(n||s||a)&&(e.payload.data.visit=Object.assign(Object.assign({},r),{basket:n,carton:s,egg:a})),t()};const ie={"Asset Viewed":2e3,default:1e3};class oe{constructor(e){this._eventsQueue={},this._delays=ie,this._delays=Object.assign(Object.assign({},this._delays),e)}add(e,t){this._eventsQueue[e]&&this.clear(e);var r=this._delays[e]||this._delays.default;this._eventsQueue[e]={timeout:setTimeout(()=>this.send(e),r),callback:t}}send(e){const t=(this._eventsQueue[e]||{})["callback"];t&&t(),this.clear(e)}clear(e){var t=(this._eventsQueue[e]||{})["timeout"];t&&clearTimeout(t),delete this._eventsQueue[e]}}class ce{constructor(e){this._id=e,this._logger=h.getLogger()}}class de extends ce{constructor(){super(...arguments),this.providerName="Hightouch"}load(s){return this._options=s,new Promise((e,r)=>{if(this._id){const t=s["anonymousId"];this.injectScript(()=>{this._logger.debug("Hightouch has been loaded"),t&&g.htevents.setAnonymousId(t),e()},e=>{var t=new Error(e);this._logger.error(e),r(t)})}else{const n=new Error("Missing Hightouch source id");this._logger.error("[HT] "+n.toString()),r(n)}})}async processEvent(e,t){var{data:r,options:n}=t;switch(e){case"Identify":return this.trackIdentify(r,n);case"Group":return this.trackGroup(r,n);case"Page":return this.trackPage(r,n);default:var s=t["name"];return this.trackDefault(s||e,r,n)}}async trackIdentify(e,t){var{userId:e,traits:r}=e;try{await g.htevents.identify(e,r,t),this._logger.debug("[HT] EVENT identify: "+e)}catch(e){this._logger.error("[HT] EVENT ERROR identify"),this._logger.debug("[HT] Error: "+e)}}async trackGroup(e,t){var{groupId:e,traits:r}=e;try{await g.htevents.group(e,r,t),this._logger.debug("[HT] EVENT group: "+e)}catch(e){this._logger.error("[HT] EVENT ERROR group"),this._logger.debug("[HT] Error: "+e)}}async trackPage(e,t){var r=e.page["pageType"];try{await g.htevents.page(r,e,t),this._logger.debug("[HT] EVENT pageview: "+r)}catch(e){this._logger.error("[HT] EVENT ERROR pageview: "+r),this._logger.debug("[HT] Error: "+e)}}async trackDefault(t,e,r){try{await g.htevents.track(t,e,r),this._logger.debug("[HT] EVENT track: "+t)}catch(e){this._logger.error("[HT] EVENT ERROR track: "+t),this._logger.debug("[HT] Error: "+e)}}injectScript(r,n){var e;const t=g.htevents=g.htevents||[];if(!t.initialize)if(t.invoked)n("Hightouch snippet already included");else{t.invoked=!0,t.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],t.factory=function(e){return function(){t.push([e].concat(Array.prototype.slice.call(arguments)))}};for(let e=0;e<t.methods.length;e++){var s=t.methods[e];t[s]=t.factory(s)}t.loadJS=function(){const e=document.createElement("script"),t=(e.type="text/javascript",e.async=!0,e.src="https://cdn.hightouch-events.com/browser/release/v1.0.0/events.min.js",e.addEventListener("load",r),e.addEventListener("error",e=>{n("Error loading Hightouch script: "+JSON.stringify(e))}),document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)},t._loadOptions={apiHost:(null==(e=this._options.hightouch)?void 0:e.apiHost)||"us-east-1.hightouch-events.com"},t._writeKey=this._id,t.loadJS()}}}const le="https://www.googletagmanager.com";class ue extends ce{constructor(){super(...arguments),this.providerName="GTM"}load(e={}){if(this._options=e,!window)return this._logger.warn("Can't load GTM. Window object not detected"),Promise.resolve();if(window.dataLayer&&0<(null==(e=window.dataLayer.filter(e=>e["gtm.start"]))?void 0:e.length)){const t=new Error("GTM is already loaded");return this._logger.error(t.toString()),Promise.reject(t)}return new Promise((e,r)=>{if(this._id){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"});this.injectScript(()=>{this._logger.debug("GTM Loaded from the wrapper"),e()},e=>{var t=new Error(e);this._logger.error(e.toString()),r(t)})}else{const t=new Error("Missing GTM id");this._logger.error(t.toString()),r(t)}})}async processEvent(e,t){var r;if(window&&window.dataLayer){var{data:t,options:n}=t,n=(n||{})["anonymousId"],s=t.userId||(null==(r=null==(s=g.analytics)?void 0:s.user)?void 0:r.call(s).id())||(null==(s=null==(r=g.htevents)?void 0:r.user)?void 0:s.call(r).id()),a=Object.assign(Object.assign({},t),{anonymousId:n,segmentAnonymousId:n,userId:s});switch(e){case"Identify":break;case"Page":window.dataLayer.push(Object.assign(Object.assign({},a),{event:"Loaded a Page"}));break;default:window.dataLayer.push(Object.assign(Object.assign({},a),{event:e}))}}else this._logger.warn("GTM cannot process the event because is not loaded or window does not exist");return Promise.resolve()}injectScript(e,t){var r;const n=document.createElement("script"),s=(n.type=(null==(r=null==(r=this._options)?void 0:r.gtm)?void 0:r.scriptType)||"text/javascript",n.async=!0,n.src=le+"/gtm.js?id="+this._id,n.addEventListener("load",e),n.addEventListener("error",e=>{t("Error loading GTM script: "+JSON.stringify(e))}),document.getElementsByTagName("script")[0]),a=(s.parentNode.insertBefore(n,s),document.createElement("iframe")),i=(a.src=le+"/ns.html?id="+this._id,a.setAttribute("width","0"),a.setAttribute("height","0"),a.style.display="none",a.style.visibility="hidden",document.createElement("noscript")),o=(i.appendChild(a),document.getElementsByTagName("body")[0]);o.prepend(i)}}class he{constructor(e){var t;this.config=e,this._providerList=[],this._logger=h.getLogger(),this._providersLoaded=!1,this._providersLoading=!1,this._dataLoaded=!1,this._queue=[],this._initialData={},this._debounce=new oe(e.eventDelays),null!=(t=e.hightouch)&&t.enabled&&this._providerList.push(new de(e.hightouch.writeKey)),null!=(t=e.gtm)&&t.enabled&&this._providerList.push(new ue(e.gtm.id)),(e.sourceId||null!=(t=e.segment)&&t.enabled)&&this._logger.warn("Segment is deprecated and should not be used anymore. SourceId and Segment option should be removed from your analytics wrapper constructor."),e.tagCollectorUrl&&this._logger.warn('SDP Tag collector is deprecated, you can remove this option "tagCollectorUrl" from your analytics wrapper constructor.')}get isDataInitialized(){return this._dataLoaded}get isLoadingComplete(){return this._providersLoaded&&this._dataLoaded}isLoadedOrLoading(){return this._providersLoaded||this._providersLoading}async load(t){if(this._providersLoaded||this._providersLoading)this._logger.warn("Providers have already been loaded");else try{this._providersLoading=!0;const r=[];this._providerList.forEach(e=>{r.push(e.load(t))}),await Promise.all(r),this._providersLoaded=!0,this._providersLoading=!1,await this.processQueue()}catch(e){this._providersLoading=!1}}async updateInitialData(e){var t=c(this._initialData);this._initialData=o(t,e),this._dataLoaded=!0,await this.processQueue()}async sendEvent(t,r){if(this.isLoadingComplete){if(!this.sendUsingDebounce(t,r)){const n=[];this._providerList.forEach(e=>{n.push(e.processEvent(t,r))}),await Promise.all(n)}}else this._queue.push({event:t,payload:r})}async processQueue(){if(this.isLoadingComplete&&0<this._queue.length){const t=[];for(;0<this._queue.length;){const{event:r,payload:n}=this._queue.shift();var e=c(this._initialData);o(e,n.data),n.data=e,t.push(this.sendEvent(r,n))}this._initialData={};try{await Promise.all(t)}catch(e){this._logger.error("Error processing queue: "+e)}}}sendUsingDebounce(t,r){return"Asset Viewed"===t?(this._debounce.add(t,()=>{this._providerList.forEach(e=>{e.processEvent(t,r)})}),!0):("Page"===t&&this._debounce.send("Asset Viewed"),!1)}getProvidersNames(){var e;return(null==(e=this._providerList.map(e=>e.providerName||"unknow"))?void 0:e.join(","))||"not defined"}}for(var L,P={ajsKey:"ajs_anonymous_id",anonymousKey:"stck_anonymous_id",anonymousKeyLegacy:"sstk_anonymous_id",sessionKey:"stck_session_id",sessionKeyLegacy:"sstk_session_id",anonymousExpiration:31536e7,sessionExpiration:18e5,defaultDomain:".shutterstock.com"},D=256,j=[];D--;)j[D]=(D+256).toString(16).substring(1);function T(){var e,t=0,r="";if(!L||256<D+16){for(L=Array(t=256);t--;)L[t]=256*Math.random()|0;t=D=0}for(;t<16;t++)e=L[D+t],r+=6==t?j[15&e|64]:8==t?j[63&e|128]:j[e],1&t&&1<t&&t<11&&(r+="-");return D++,r}function ge(e){return function(r){try{return e.document.cookie.split("; ").reduce(function(e,t){t=t.split("=");return t[0]===r?decodeURIComponent(t[1]):e},"")}catch(e){return null}}}function V(s){return function(e,t,r){var n=s.location.hostname,n=we(n),r=new Date(Date.now()+r).toUTCString(),t=encodeURIComponent(t);try{return s.document.cookie="".concat(e,"=").concat(t,"; expires=").concat(r,"; path=/; domain=").concat(n),!0}catch(e){return!1}}}function pe(r){return function(e,t){try{return r.localStorage.setItem(e,t),!0}catch(e){return!1}}}function ye(e){return function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return null},n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){return!1},s=e(P.anonymousKey);return s||('"'===(s=(s=r(P.anonymousKey)||e(P.anonymousKeyLegacy)||r(P.anonymousKeyLegacy)||e(P.ajsKey))||T()).charAt(0)&&(s=s.slice(1,-1)),t(P.anonymousKey,s,P.anonymousExpiration),t(P.anonymousKeyLegacy,s,P.anonymousExpiration),n(P.anonymousKey,s)),s}(ge(e),V(e),function(e){try{return t.localStorage.getItem(e)}catch(e){return null}},pe(t=e));var t}function me(e){return function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=e(P.sessionKey);return n||(r=!0,n=(n=e(P.sessionKeyLegacy))||T()),r&&(t(P.sessionKey,n,P.sessionExpiration),t(P.sessionKeyLegacy,n,P.sessionExpiration)),n}(ge(e),V(e),1<arguments.length&&void 0!==arguments[1]&&arguments[1])}function ve(e){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return!1},r=T();return e(P.anonymousKey,r,P.anonymousExpiration),e(P.anonymousKeyLegacy,r,P.anonymousExpiration),t(P.anonymousKey,r),r}(V(e),pe(e))}function fe(e){return e=V(e),t=T(),e(P.sessionKey,t,P.sessionExpiration),e(P.sessionKeyLegacy,t,P.sessionExpiration),t;var t}var we=function(e){if(!e)return null;var t=e.split(".").slice(1);return 1<t.length?".".concat(t.join(".")):e},_e=["gclid","kw","gclsrc","msclkid","fbclid","yclid","image_type","irgwc","irclickid","int_source","int_medium","int_campaign","int_content","utm_medium","utm_source","utm_campaign","utm_term"];class N{constructor(){this._logger=h.getLogger(),this._sessionStart=Date.now(),this.initCookieDomain(),this._anonymousId=ye(g),this._sessionId=this.extendSession(),this._googleClientId=null}get anonymousId(){return this._anonymousId}get sessionId(){return this._sessionId||this.extendSession()}get googleClientId(){if(!this._googleClientId){const e=this.getCookie(N.GAIdKey);e&&(this._googleClientId=e.split(".").slice(2).join("."))}return this._googleClientId}extendSession(){N.SessionExpires<Date.now()-this._sessionStart&&(this._sessionId=fe(g),this._sessionStart=Date.now());var e=N.SessionExtensionMinimum<Date.now()-this._sessionStart;return this._sessionId&&!e||(this._sessionId=me(g,e),e&&(this._sessionStart=Date.now())),this._sessionId}reset(){this._anonymousId=ve(g),this._sessionId=fe(g),this._sessionStart=Date.now()}processVisitData(){const s={};try{const e=new URL(g.location)["searchParams"];e.forEach((e,t)=>{var r,n;"pl"===t&&([r,n]=e.split("-"),s.basket=r,s.carton=n),"cr"===t&&(s.egg=e),0<=_e.indexOf(t)&&(Object.prototype.hasOwnProperty.call(s,"parameters")||(s.parameters={}),s.parameters[t]=e)})}catch(e){this._logger.error("Error getting visit data"),this._logger.debug("Error: "+e)}return s}persistBasketCartEgg(e){let{basket:t,carton:r,egg:n}=e;const s=this.getCookie(N.BceKey);return t||r||n||([t,r,n]=s.split("-")),(t||r||n)&&(e=`${t||""}-${r||""}-`+(n||""),s!==e&&this.setCookie(N.BceKey,e,N.BceExpiration)),{basket:t,carton:r,egg:n}}initCookieDomain(){const e=g.location["hostname"],t=e.split(".").slice(1);1<t.length?this._cookieDomain="."+t.join("."):this._cookieDomain=e}getCookie(r){try{return g.document.cookie.split("; ").reduce((e,t)=>{t=t.split("=");return t[0]===r?decodeURIComponent(t[1]):e},"")}catch(e){this._logger.warn(`graceful degradation of getCookie, error getting ${r} flag, gracefully degrading to undefined`)}}setCookie(t,e,r){try{var n=new Date(Date.now()+r).toUTCString(),s=encodeURIComponent(e);return g.document.cookie=t+`=${s}; expires=${n}; path=/; domain=`+this._cookieDomain,!0}catch(e){return this._logger.warn(`graceful degradation of setCookie, error setting ${t} flag, gracefully degrading to undefined`),!1}}}N.BceKey="bce",N.GAIdKey="_ga",N.SessionExtensionMinimum=12e5,N.SessionExpires=18e5,N.BceExpiration=2592e6;var be;const ke=async e=>{try{var t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);const n=Array.from(new Uint8Array(r));return n.map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){return null}};class Ee{constructor(e){this.getAnonID=()=>this.getAnonId(),this.getAnonId=()=>{var e;return(null==(e=this.trackingIds)?void 0:e.anonymousId)||"unknown"},this.isProviderLoadingOrLoaded=()=>this._providers.isLoadedOrLoading(),this.hashField=async e=>{return await ke(e)},this.getSessionId=()=>{var e;return(null==(e=this.trackingIds)?void 0:e.sessionId)||"unknown"},this._options=e||{},this._debugMode=this._options.debugMode||!1,this._analyticsData=new x,this._logger=h.getLogger(this._debugMode),this._listener=null,this._middlewareEngine=new X,g?this._trackingIds=new N:this._trackingIds=null,this._providers=new he(this._options),this.setupMiddleware(),g&&(this.enrichVisitData(),g.sstkAW=this)}get trackingIds(){return this._trackingIds}async loadProvider(e,t){t=t||this._options.consentCategories;e&&this._logger.warn('Segment is not being used anymore. Dont use "sourceId" on "loadProvider", check the constructor options to use other providers instead.'),t&&this._logger.warn('Segment is not being used anymore. Dont use "categories" on "loadProvider", check the constructor options to use other providers instead.');try{await this._providers.load({anonymousId:this.getAnonId(),hightouch:this._options.hightouch,gtm:this._options.gtm})}catch(e){throw this._logger.error("error starting wrapper: "+e,!0),e}return this}async setInitialData(e){e=Object.assign(Object.assign({},e),{version:"5.13.0"});this._analyticsData.update(e),this._providers.isDataInitialized||await this._providers.updateInitialData(e)}setData(e){this._analyticsData.update(e)}startListener(e){return this._listener?this._logger.warn("listener has already been started"):(this._listener=new Z(e),this._listener.listen(this)),this}async identify(e,t){if("string"!=typeof e)throw this._logger.error((r="identify method requires the userId to be set.")+" eg: identify(userId, traitsObject)"),new Error(r);var r=this._analyticsData.toJSON()["user"],n=(null!=r&&r.email_sha||!t.email||(n=await ke(t.email),this._analyticsData.update({user:{email_sha:n}})),t.isImpersonated||(r||{}).isImpersonated);if(e&&!n){r={userId:e,traits:t};try{await this.sendEvent("Identify",{data:r})}catch(e){n="Unable to send identify";throw this._logger.error(n+": "+e),new Error(n)}}return this}async group(t,e){if("string"!=typeof t||!t)throw this._logger.error((r="group method requires the groupId to be set.")+" eg: group(groupId, traitsObject)"),new Error(r);var r={groupId:t,traits:e};try{await this.sendEvent("Group",{data:r})}catch(e){t="Unable to send group";throw this._logger.error(t+": "+e),new Error(t)}return this}setupMiddleware(){this._middlewareEngine.use("Page",ne),this._middlewareEngine.use(null,se),this._middlewareEngine.use("Page",ae),this._middlewareEngine.use(null,ee),this._middlewareEngine.use(null,re),this._middlewareEngine.use(null,te)}async track(t,r){try{var e=this._analyticsData.overlay(r||{});return await this.sendEvent(t,{data:e}),this}catch(e){r=`Unable to send ${t} event`;throw this._logger.error(r+": "+e),new Error(r)}}async sendProductArray(t,r){try{var n=r.batch_id||d();const o=[];for(let e=0;e<r.products.length;e+=1){var s=r.products[e];const c=Object.assign(Object.assign({},r),s);c.batch_id=n,delete c.products;var a=this._analyticsData.overlay(c);o.push(this.sendEvent(t,{data:a}))}return await Promise.all(o),this}catch(e){var i="Unable to send batched event for "+t;throw this._logger.error(i+": "+e),new Error(i)}}async sendEvent(e,t){return await this._middlewareEngine.execute(e,{wrapper:this,payload:t}),await this._providers.sendEvent(e,t),this}enrichVisitData(){var e=this._trackingIds.processVisitData();this._analyticsData.update({visit:e})}getProvidersNames(){return this._providers.getProvidersNames()}}return be=Ee,Object.values(U).forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(e=>{Object.defineProperty(be.prototype,e,Object.getOwnPropertyDescriptor(t.prototype,e)||Object.create(null))})}),Ee}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ConsentLibrary=t()}(this,function(){"use strict";e.loadScript=function(s){return new Promise(function(e,t){var r=document.createElement("script"),n=(r.src=s.src,r.type="text/javascript",r.async=s.async||!0,r.defer=s.defer||!0,(s.attributes||[]).forEach(function(e){return r.setAttribute(e.name,e.value)}),r.onload=function(){e()},document.getElementsByTagName("head")[0]);return n?(n.appendChild(r),r):t(new Error("Couldn't find target to inject script."))})};var n=e,t=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PO","PT","RO","SK","SI","ES","SE"],r={C0001:["A/B testing","Security & Fraud","Tag Managers"],C0002:["Analytics","Customer Success","Feature Flagging","Performance Monitoring","Raw Data","Surveys","Video"],C0003:["CRM","Heatmaps & Recordings","Livechat","Personalization","Storage Destinations"],C0004:["Advertising","Attribution","Deep linking","Email","Email Marketing","Enrichment","Marketing Automation"],C0005:["Referrals","SMS & Push Notifications"]},s="consentlibrary-geo-variant";function e(){}return a.prototype.load=function(){var r=this;return new Promise(function(e,t){if(!0===window.isConsentLibraryLoaded)return t(new Error("Onetrust already loaded"));window.dataLayer=window.dataLayer||[],r.loadGeoVariant(),r.createOptanonWrapper(e);e={src:"https://cdn.cookielaw.org/scripttemplates/otSDKStub.js",attributes:[{name:"data-domain-script",value:r.params.id},{name:"data-document-language",value:"true"}]};n.loadScript(e).catch(t)})},a.prototype.isGDPR=function(){var e=this.getProvider().getGeolocationData();return 0<=t.indexOf(e.country.toUpperCase())},a.prototype.isCCPA=function(){var e=this.getProvider().getGeolocationData();return"US"===e.country.toUpperCase()&&"CA"===e.state.toUpperCase()},a.prototype.getSegmentAcceptedCategories=function(){var e=this.getOneTrustAcceptedCategories(),t=[];return e.forEach(function(e){t.push.apply(t,r[e])}),t},a.prototype.getAcceptedCategories=function(){return{provider:this.getOneTrustAcceptedCategories(),segment:this.getSegmentAcceptedCategories()}},a.prototype.getProvider=function(){return this.provider},a.setGeoVariant=function(e,t){var r;null!=(r=window.localStorage)&&r.setItem(s,e+","+t)},a.clearGeoVariant=function(){var e;null!=(e=window.localStorage)&&e.removeItem(s)},a;function a(e){var t=this;this.loadGeoVariant=function(){var e=t.getGeoVariant();e&&(window.OneTrust={geolocationResponse:{countryCode:e.country,stateCode:e.state}})},this.createOptanonWrapper=function(e){window.OptanonWrapper=function(){t.provider=window.Optanon,window.OnetrustCachedGroups!==window.OptanonActiveGroups&&window.Optanon.OnConsentChanged(t.params.onConsentChanged),window.OnetrustCachedGroups=window.OptanonActiveGroups,window.isConsentLibraryLoaded=!0,!t.loaded&&t.params.onLoad&&t.params.onLoad(),t.loaded=!0,e()}},this.getOneTrustAcceptedCategories=function(){return window.OptanonActiveGroups?window.OptanonActiveGroups.split(",").filter(function(e){return e&&0<e.length}):[]},this.getGeoVariant=function(){var e,t=null==(t=window.localStorage)?void 0:t.getItem(s);return t?{country:null==(e=t.trim().split(",")[0])?void 0:e.trim(),state:null==(e=t.trim().split(",")[1])?void 0:e.trim()}:null},this.params=e,this.loaded=!1,this.params.onConsentChanged=this.params.onConsentChanged||function(){}}});